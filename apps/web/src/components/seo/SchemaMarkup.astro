---
/**
 * SchemaMarkup - Consolidated JSON-LD (Optimized Dec 2025)
 *
 * Single @graph with essential schemas only:
 * - WebApplication (primary)
 * - HowTo (AI citation magnet)
 * - FAQPage (rich snippets)
 * - BreadcrumbList (navigation)
 */

interface FAQItem {
  question: string;
  answer: string;
}

interface Props {
  toolId: string;
  toolName: string;
  description: string;
  category: 'document' | 'media' | 'ai' | 'utility';
  steps: string[];
  faqs: FAQItem[];
  url: string;
}

const { toolName, description, category, steps, faqs, url } = Astro.props;

const categoryMap = {
  document: 'ProductivityApplication',
  media: 'MultimediaApplication',
  ai: 'UtilitiesApplication',
  utility: 'UtilitiesApplication'
};

const baseUrl = 'https://www.newlifesolutions.dev';
const currentDate = new Date().toISOString().split('T')[0];

// Single consolidated schema using @graph
const consolidatedSchema = {
  '@context': 'https://schema.org',
  '@graph': [
    // WebApplication - Primary
    {
      '@type': 'WebApplication',
      '@id': `${baseUrl}${url}#app`,
      name: toolName,
      description: description,
      url: `${baseUrl}${url}`,
      applicationCategory: categoryMap[category],
      operatingSystem: 'Any',
      browserRequirements: 'JavaScript enabled',
      offers: {
        '@type': 'Offer',
        price: '0',
        priceCurrency: 'USD'
      },
      author: { '@id': `${baseUrl}#org` },
      dateModified: currentDate
    },
    // HowTo - Steps
    {
      '@type': 'HowTo',
      name: `How to use ${toolName}`,
      step: steps.map((text, i) => ({
        '@type': 'HowToStep',
        position: i + 1,
        text
      })),
      tool: { '@type': 'HowToTool', name: 'Web Browser' }
    },
    // FAQPage
    ...(faqs.length > 0 ? [{
      '@type': 'FAQPage',
      mainEntity: faqs.map(faq => ({
        '@type': 'Question',
        name: faq.question,
        acceptedAnswer: { '@type': 'Answer', text: faq.answer }
      }))
    }] : []),
    // BreadcrumbList
    {
      '@type': 'BreadcrumbList',
      itemListElement: [
        { '@type': 'ListItem', position: 1, name: 'Home', item: baseUrl },
        { '@type': 'ListItem', position: 2, name: 'Tools', item: `${baseUrl}/hub` },
        { '@type': 'ListItem', position: 3, name: toolName, item: `${baseUrl}${url}` }
      ]
    },
    // Organization (referenced by @id)
    {
      '@type': 'Organization',
      '@id': `${baseUrl}#org`,
      name: 'New Life Solutions',
      url: baseUrl
    }
  ]
};
---

<script type="application/ld+json" set:html={JSON.stringify(consolidatedSchema)} />
