---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/ui/Navbar.astro';
import Hero from '../components/ui/Hero.astro';
import DocumentSuite from '../components/ui/DocumentSuite.astro';
import { ToolHub } from '../components/tools/ToolHub';
import Footer from '../components/ui/Footer.astro';
import { tools } from '../lib/tools';
import { getLiveGames } from '../lib/games';

// Convert games to tools format so they appear in the hub
const liveGames = getLiveGames();
const gamesAsTools = liveGames.map(game => ({
  id: game.id,
  name: game.name,
  description: game.description,
  icon: 'ðŸŽ®',
  thumbnail: game.thumbnail,
  category: 'games' as const,
  tier: 'free' as const,
  href: game.href,
  color: 'from-purple-500 to-pink-500',
  tags: ['game', 'casual', 'puzzle', 'arcade'],
  popular: game.isNew || false,
  releaseDate: game.releaseDate || '2026-01-01',
  seo: game.seo,
  stats: game.stats
}));

// Combine tools and games
const allHubItems = [...tools, ...gamesAsTools];

// SEO metadata
const title = 'New Life Solutions - Free Privacy-First Browser Tools';
const description = 'Free online tools for developers and creatives. Merge PDFs, compress images, generate QR codes, and more. 100% browser-based, private, and secure. No signup required.';
---

<Layout title={title} description={description} canonicalUrl="https://www.newlifesolutions.dev/">
  <Navbar />
  <main class="pt-16">
    <Hero />

    <!-- Document Suite - PDF/Word/JPG grouped tools -->
    <DocumentSuite />

    <!-- Section Divider -->
    <div class="section-divider">
      <span class="divider-symbol">â—‡</span>
    </div>

    <!-- Category Nav Pills -->
    <section class="category-nav py-12 px-8">
      <div class="flex justify-center gap-4 flex-wrap" id="category-pills">
        <button class="category-pill active" data-category="all">All Tools</button>
        <button class="category-pill" data-category="pdf">Document</button>
        <button class="category-pill" data-category="media">Media</button>
        <button class="category-pill" data-category="ai">AI-Powered</button>
        <button class="category-pill" data-category="utility">Utility</button>
      </div>
    </section>

    <!-- Tool Hub with Search and Filters -->
    <section id="tools" class="py-24 px-8">
      <div class="max-w-7xl mx-auto">
        <!-- SEO-friendly heading structure -->
        <div class="text-center mb-16">
          <div class="text-[0.625rem] text-[var(--cyan)] tracking-[0.3em] uppercase mb-4">// Tool Hub</div>
          <h1 class="font-display text-2xl uppercase tracking-[0.1em] mb-4">Everything You Need</h1>
          <p class="text-[var(--text-dim)] text-sm max-w-2xl mx-auto leading-relaxed">
            Browse our collection of {allHubItems.length} free browser-based tools and games. Search, filter by category,
            or sort by popularity to find exactly what you need.
          </p>
        </div>

        <!-- Interactive Tool Hub Component -->
        <ToolHub client:load tools={allHubItems} />
      </div>
    </section>

    <!-- Section Divider -->
    <div class="section-divider">
      <span class="divider-symbol rotating">âˆž</span>
    </div>

    <!-- Privacy/Trust Section -->
    <section id="about" class="py-32 px-8">
      <div class="max-w-6xl mx-auto">
        <div class="grid md:grid-cols-2 gap-16 items-center">
          <!-- Content -->
          <div class="privacy-content">
            <div class="text-[0.625rem] text-[var(--cyan)] tracking-[0.3em] uppercase mb-4">// Privacy First</div>
            <h2 class="font-display text-2xl uppercase tracking-[0.1em] mb-6 leading-tight">
              Your Data Never<br/>Leaves Your Device
            </h2>
            <p class="text-[var(--text-dim)] mb-8 leading-relaxed">
              Every tool runs entirely in your browser using WebAssembly and modern APIs.
              We can't see your files because they never touch our servers.
            </p>

            <div class="space-y-6">
              <div class="flex gap-4 items-start">
                <div class="w-10 h-10 flex items-center justify-center border border-[var(--border)] text-[var(--text-dim)] shrink-0">â¬¡</div>
                <div>
                  <h4 class="font-display font-medium text-sm mb-1">Client-Side Processing</h4>
                  <p class="text-xs text-[var(--text-muted)]">All computation happens in your browser using WebAssembly</p>
                </div>
              </div>

              <div class="flex gap-4 items-start">
                <div class="w-10 h-10 flex items-center justify-center border border-[var(--border)] text-[var(--text-dim)] shrink-0">âŠ˜</div>
                <div>
                  <h4 class="font-display font-medium text-sm mb-1">No Upload Required</h4>
                  <p class="text-xs text-[var(--text-muted)]">Files are processed locally - nothing is sent to any server</p>
                </div>
              </div>

              <div class="flex gap-4 items-start">
                <div class="w-10 h-10 flex items-center justify-center border border-[var(--border)] text-[var(--text-dim)] shrink-0">â—‹</div>
                <div>
                  <h4 class="font-display font-medium text-sm mb-1">Works Offline</h4>
                  <p class="text-xs text-[var(--text-muted)]">PWA support means tools work even without internet</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Visual -->
          <div class="privacy-visual order-first md:order-last">
            <div class="privacy-orb"></div>
            <div class="privacy-rings">
              <div class="ring"></div>
              <div class="ring"></div>
              <div class="ring"></div>
            </div>
            <div class="privacy-lock">â—ˆ</div>
          </div>
        </div>
      </div>
    </section>

    <!-- CTA Section -->
    <section class="py-24 px-8">
      <div class="max-w-4xl mx-auto">
        <div class="cta-box p-16 border border-[var(--border)] text-center relative overflow-hidden">
          <div class="cta-gradient"></div>
          <h2 class="font-display text-xl uppercase tracking-[0.1em] mb-4 relative z-10">Ready to Get Started?</h2>
          <p class="text-[var(--text-dim)] mb-8 max-w-md mx-auto relative z-10">
            Join thousands of users who trust New Life for their daily file processing needs. Free forever.
          </p>
          <a href="#tools" class="btn-primary border-[var(--cyan)] text-[var(--cyan)] hover:bg-[var(--cyan)] hover:text-[var(--void)] relative z-10">
            <span>Launch Tool Hub</span>
            <span>â†’</span>
          </a>
        </div>
      </div>
    </section>
  </main>
  <Footer />
</Layout>

<style>
  .cta-gradient {
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at 50% 0%, var(--cyan-subtle) 0%, transparent 60%);
    pointer-events: none;
  }

  /* Privacy visual positioning */
  .privacy-visual {
    position: relative;
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    max-width: 400px;
    margin: 0 auto;
  }

  @media (max-width: 768px) {
    .privacy-visual {
      max-width: 280px;
    }
  }
</style>

<!-- JSON-LD Structured Data for SEO + GEO -->
<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@graph": [
    // CollectionPage - Primary
    {
      "@type": "CollectionPage",
      "@id": "https://www.newlifesolutions.dev/#collection",
      "name": title,
      "description": description,
      "url": "https://www.newlifesolutions.dev/",
      "inLanguage": "en-US",
      "isPartOf": { "@id": "https://www.newlifesolutions.dev/#website" },
      "about": {
        "@type": "Thing",
        "name": "Privacy-First Browser Tools",
        "description": "Free online tools that process files locally in your browser"
      },
      "mainEntity": {
        "@type": "ItemList",
        "numberOfItems": allHubItems.length,
        "itemListElement": tools.slice(0, 10).map((tool, index) => ({
          "@type": "ListItem",
          "position": index + 1,
          "item": {
            "@type": "SoftwareApplication",
            "name": tool.name,
            "description": tool.description,
            "url": `https://www.newlifesolutions.dev${tool.href}`,
            "applicationCategory": tool.category === 'pdf' ? 'ProductivityApplication' : tool.category === 'ai' ? 'UtilitiesApplication' : 'MultimediaApplication',
            "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
            "operatingSystem": "Any (Browser-based)"
          }
        }))
      }
    },
    // WebSite
    {
      "@type": "WebSite",
      "@id": "https://www.newlifesolutions.dev/#website",
      "url": "https://www.newlifesolutions.dev",
      "name": "New Life Solutions",
      "description": "Free privacy-first browser tools for PDF, images, video, and more",
      "publisher": { "@id": "https://www.newlifesolutions.dev/#org" },
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "https://www.newlifesolutions.dev/hub?q={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      }
    },
    // Organization
    {
      "@type": "Organization",
      "@id": "https://www.newlifesolutions.dev/#org",
      "name": "New Life Solutions",
      "url": "https://www.newlifesolutions.dev",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.newlifesolutions.dev/favicon.svg"
      },
      "sameAs": ["https://github.com/newlifesolutions"],
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer support",
        "availableLanguage": ["English"]
      }
    },
    // BreadcrumbList
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://www.newlifesolutions.dev" },
        { "@type": "ListItem", "position": 2, "name": "Tool Hub", "item": "https://www.newlifesolutions.dev/hub" }
      ]
    },
    // Speakable for voice search
    {
      "@type": "WebPage",
      "speakable": {
        "@type": "SpeakableSpecification",
        "cssSelector": ["h1", ".hero-subtitle", "meta[name='description']"]
      }
    }
  ]
})} />

<script>
  // Category pill filtering (connects to ToolHub)
  document.addEventListener('DOMContentLoaded', () => {
    const pills = document.querySelectorAll('.category-pill');

    pills.forEach(pill => {
      pill.addEventListener('click', () => {
        // Update active state
        pills.forEach(p => p.classList.remove('active'));
        pill.classList.add('active');

        // Emit custom event for ToolHub to listen to
        const category = (pill as HTMLElement).dataset.category;
        window.dispatchEvent(new CustomEvent('categoryFilter', { detail: { category } }));
      });
    });
  });
</script>
