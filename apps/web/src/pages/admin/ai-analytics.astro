---
/**
 * AI Analytics Dashboard Page
 *
 * Production analytics dashboard for monitoring AI traffic patterns
 * and GEO optimization performance
 */

import Layout from '../../layouts/Layout.astro';
import Navbar from '../../components/ui/Navbar.astro';
import Footer from '../../components/ui/Footer.astro';
import AIAnalyticsDashboard from '../../components/dashboard/AIAnalyticsDashboard.tsx';

// Security: Only show dashboard if analytics are enabled
const analyticsEnabled = import.meta.env.ENABLE_AI_ANALYTICS !== 'false';

// SEO metadata
const title = 'AI Analytics Dashboard | New Life Solutions';
const description = 'Real-time analytics dashboard for monitoring AI platform traffic patterns and GEO optimization performance.';
---

<Layout title={title} description={description}>
  <Navbar />

  <main class="pt-16">
    <!-- Hero Section -->
    <section class="py-20 px-6 border-b border-[var(--border)]">
      <div class="max-w-4xl mx-auto text-center">
        <div class="text-[0.625rem] uppercase tracking-[0.3em] text-[var(--text-muted)] mb-4">
          Analytics Dashboard
        </div>
        <h1 class="text-3xl sm:text-4xl font-semibold mb-6">
          AI Traffic Analytics
        </h1>
        <p class="text-[var(--text-dim)] text-base max-w-2xl mx-auto leading-relaxed mb-8">
          Real-time monitoring of AI platform traffic patterns, content extraction performance,
          and GEO optimization effectiveness. Privacy-first analytics with session-based storage only.
        </p>
        <div class="flex flex-wrap justify-center gap-4 text-[0.625rem] text-[var(--text-muted)] uppercase tracking-[0.15em]">
          <span>Privacy-First</span>
          <span>Session Storage Only</span>
          <span>GDPR Compliant</span>
        </div>
      </div>
    </section>

    <!-- Dashboard Section -->
    {analyticsEnabled ? (
      <section class="py-12 px-6">
        <div class="max-w-7xl mx-auto">
          <AIAnalyticsDashboard client:load />
        </div>
      </section>
    ) : (
      <section class="py-20 px-6">
        <div class="max-w-2xl mx-auto text-center">
          <div class="glass-card p-12">
            <div class="text-[var(--warning)] text-4xl mb-4">‚ö†Ô∏è</div>
            <h2 class="text-xl font-semibold mb-4">Analytics Not Enabled</h2>
            <p class="text-[var(--text-dim)] mb-6">
              AI Analytics tracking is currently disabled. To enable:
            </p>
            <div class="bg-[var(--bg-secondary)] p-4 rounded-lg border font-mono text-sm text-left overflow-x-auto mb-6">
              <pre>ENABLE_AI_ANALYTICS=true</pre>
            </div>
            <p class="text-[var(--text-dim)] text-sm">
              Set this environment variable and rebuild the application.
            </p>
          </div>
        </div>
      </section>
    )}

    <!-- Documentation Section -->
    <section class="py-20 px-6 border-t border-[var(--border)]">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-2xl font-semibold mb-8 text-center">Understanding AI Analytics</h2>

        <div class="grid md:grid-cols-2 gap-8">
          <div class="glass-card p-8">
            <h3 class="text-lg font-semibold mb-4 text-[var(--success)]">What We Track</h3>
            <ul class="space-y-3 text-[var(--text-dim)] text-sm">
              <li class="flex items-start gap-2">
                <span class="text-[var(--success)] mt-1">‚Ä¢</span>
                AI platform detection (Claude, GPT-4, Gemini, Perplexity)
              </li>
              <li class="flex items-start gap-2">
                <span class="text-[var(--success)] mt-1">‚Ä¢</span>
                Page views and navigation patterns
              </li>
              <li class="flex items-start gap-2">
                <span class="text-[var(--success)] mt-1">‚Ä¢</span>
                Content extraction performance
              </li>
              <li class="flex items-start gap-2">
                <span class="text-[var(--success)] mt-1">‚Ä¢</span>
                Citation and conversion events
              </li>
            </ul>
          </div>

          <div class="glass-card p-8">
            <h3 class="text-lg font-semibold mb-4 text-[var(--success)]">Privacy Protection</h3>
            <ul class="space-y-3 text-[var(--text-dim)] text-sm">
              <li class="flex items-start gap-2">
                <span class="text-[var(--success)] mt-1">‚úì</span>
                No personal data collection
              </li>
              <li class="flex items-start gap-2">
                <span class="text-[var(--success)] mt-1">‚úì</span>
                Local browser storage only
              </li>
              <li class="flex items-start gap-2">
                <span class="text-[var(--success)] mt-1">‚úì</span>
                30-day data retention
              </li>
              <li class="flex items-start gap-2">
                <span class="text-[var(--success)] mt-1">‚úì</span>
                Respects Do Not Track
              </li>
            </ul>
          </div>
        </div>

        <div class="mt-8 text-center">
          <a
            href="/docs/geo-system/WEEK5_ANALYTICS.md"
            class="btn-primary inline-block px-6 py-3 rounded-lg font-medium"
          >
            Read Full Documentation ‚Üí
          </a>
        </div>
      </div>
    </section>

    <!-- Performance Metrics Section -->
    <section class="py-20 px-6 border-t border-[var(--border)] bg-[var(--bg-secondary)]">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-2xl font-semibold mb-6 text-center">Performance Impact</h2>

        <div class="grid md:grid-cols-3 gap-6">
          <div class="text-center">
            <div class="text-3xl font-bold text-[var(--success)] mb-2">50-70%</div>
            <div class="text-[var(--text-dim)]">
              Faster content extraction
              <div class="text-sm mt-1">for AI crawlers</div>
            </div>
          </div>

          <div class="text-center">
            <div class="text-3xl font-bold text-[var(--primary)] mb-2">90%</div>
            <div class="text-[var(--text-dim)]">
              Schema parsing improvement
              <div class="text-sm mt-1">vs. unoptimized pages</div>
            </div>
          </div>

          <div class="text-center">
            <div class="text-3xl font-bold text-[var(--warning)] mb-2">0ms</div>
            <div class="text-[var(--text-dim)]">
              Impact on regular users
              <div class="text-sm mt-1">optimizations only for AI</div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>

<style>
  .glass-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 12px;
    backdrop-filter: blur(10px);
  }
</style>

<!-- Analytics Configuration -->
<script>
  // Initialize analytics when page loads
  if (typeof window !== 'undefined') {
    const initAnalytics = () => {
      // Auto-initialize in production
      if (window.location.hostname !== 'localhost') {
        import('../../lib/ai-analytics').then(({ aiAnalytics }) => {
          aiAnalytics.initialize({
            enabled: true,
            sampleRate: 1.0,
            privacyMode: true
          });
          console.log('ü§ñ AI Analytics initialized on dashboard page');
        });
      }
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initAnalytics);
    } else {
      initAnalytics();
    }
  }
</script>

<!-- Structured Data for SEO -->
<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "AI Analytics Dashboard",
  "description": "Real-time analytics dashboard for monitoring AI platform traffic patterns",
  "url": "https://www.newlifesolutions.dev/admin/ai-analytics",
  "applicationCategory": "AnalyticsApplication",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "featureList": [
    "Real-time AI traffic monitoring",
    "Platform distribution analysis",
    "Content extraction performance",
    "Conversion attribution tracking",
    "Privacy-first analytics",
    "A/B testing integration"
  ]
})} />
